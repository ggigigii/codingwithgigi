---
title: "R in ECON 435 - Week 3"
author: "Team MAG [Max, Artem, Gigi]"
date: "October 2, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

Learning how to work with functions in R will make your ECON 435 experience a lot more pleasant down the road. 
Please read [this article](http://nicercode.github.io/guides/functions/) before you start this problem set.
If you want some practice before you start work on this problem set, try [these exercise with solutions](https://www.r-bloggers.com/functions-exercises/).

The best way to learn to work with functions is to try it. This problem set forces you to do so.
As the same time, you are reminded of your probability theory concepts, and practice working with vectors and matrices in R.

Instructions are as in PS1 and 2.

# Probability theory

For this assignment we will create a joint probability table and use it to compute marginal and conditional probabilities, expectations and conditional expectations, variances, and pmf's and CDF's.

We have two random variables, $X$ and $Y$, with their respective sample spaces:
$$\Omega_x = \{0,5,10\}$$
$$\Omega_y = \{0,5,10,15\}$$

The joint probability table for these random variables is given by:

|        | $Y=0$ | $Y=5$ | $Y=10$ | $Y=15$ |
| ------ | ----- | ----- | ------ | ------ |
| $X=0$  | 0.02  | 0.06  | 0.02   | 0.10   |
| $X=5$  | 0.04  | 0.15  | 0.20   | 0.10   |
| $X=10$ | 0.01  | 0.15  | 0.14   | 0.01   |

We generate this matrix in R, and call it `p`, as follows:

```{r}
p <- matrix(
  c(.02,.04,.01,.06,.15,.15,.02,.20,.14,.10,.10,.01),
  ncol=4)
p
```

Your matrix `p` stores all joint probabilities. If you wanted to display $P(X=5,Y=20$, which is the element on row 2, column 3 of matrix p, you write:

```{r}
p[2,3]
```

## Question 1

Display $P(X=0,Y=5)$.

`## Answer 1`
We see that $P(X=0,Y=5)$'s position in the matrix is in row 1 and column 2. We pull this element from our matrix `p` by specifying the position p[row,column] as p[1,2]. The corresponding probability is 0.06.
```{r}
p[1,2]
```
...

<!-- --- -->

To check that matrix `p` indeed contains a joint probability distribution of $X$ and $Y$, you know that if you add all the elements of `p` you should get 1. To see that this is the case, type:
```{r}
sum(p)
```
We see that by using the sum() function, we have added up all elements in matrix `p`, and the additive probability is 1. 

Now, remember that, for example, the marginal probability of $X=0$ is given by:
$$ P(X=0) = P(X=0,Y=0) + P(X=0,Y=5) + P(X=0,Y=10) + P(X=0,Y=15).$$

## Question 2

Using one line of code, compute the marginal probability distribution of $X$ as a $3 \times 1$ vector.

`## Answer 2`
The marginal probability distribution of X as a 3x1 vector is shown as the sum of all probabilities associated with a given value of X=Xi. Take for example, X=0, if we add up all probabilities associated with Pr(X=0,Y=Yi), we see the sum is 0.06+0.02+0.10+0.02 = 0.20. This can be repeated for all associated probabilities of X=5 and X=10. We do not specify any value in the 'column' index of p[] as this will sum across all columns, for a given row. 
The marginal probability distribution of X=0 is 0.20, X=5 is 0.49, and for X=10 is 0.31. 
```{r}
px1 <- c(sum(p[1,]),sum(p[2,]), sum(p[3,]))
px1
```
...

<!-- --- -->

Instead of writing your own code, you could have used the `apply` technology. Using `apply` is a useful tool for advanced tasks in R, so I am giving you the below code for future reference.

We can use the apply() function to create a marginal probability for X. 
```{r}
px <- apply(p,1,sum)
px                   
```

The apply function says: Take matrix `p`, and, row by row ("1" means "by row"), compute the sum of the elements in the row. This function is very powerful since it computes the sums for all rows at once.

...

## Question 3

Use `apply` to compute the marginal probability distribution of $Y$.

`## Answer 3`
We can use the apply() function to create a marginal probability for Y. We will take matrix `p` and, column by column, compute the sum of the elements in the column. This will result in a list of marginal probabilities for Y. 
```{r}
py <- apply(p, 2, sum)
```

<!-- --- -->

Remember that the definition of conditional probabilities for discrete random variables is $$ P(X=x|Y=y) = \frac{P(X=x,Y=y)}{P(Y=y)}.$$

## Question 4

Write a function `cond_prob` that, for any matrix that represents a joint probability distribution, for any value of the random variable that runs across the columns, returns the conditional probability distribution.

Try your function on `p`. Try it on another joint probability distribution, call it `q`, that you create yourself.

`## Answer 4`
We create another matrix of joint probability distribution called `q`, with 4 columns and 3 rows, similar to our matrix `p`. 

```{r}
q <- matrix(
  c(.15,.14,.01,.03,.07,.1,.14,.01,.1,.14,.01,.1),
  ncol=4)
q
```
We generate this matrix in R, and call it `q`, as follows:

|        | $Y=0$ | $Y=5$ | $Y=10$ | $Y=15$ |
| ------ | ----- | ----- | ------ | ------ |
| $X=0$  | 0.15  | 0.03  | 0.14   | 0.14   |
| $X=5$  | 0.14  | 0.07  | 0.01   | 0.01   |
| $X=10$ | 0.01  | 0.10  | 0.10   | 0.10   |

We create a function 'cond_prob' that takes parameters 'y' (column[i] to pull the marginal probability corresponding to Y=Yi) and matrix 'p'. We then create a vector 'columns' to house our marginal probability distribution of Y=Yi, which we calculate using the apply() function. We calculate the conditional probability of Y=Yi by taking the probability of Y=Yi as it runs through the columns, and dividing by the corresponding column [i]'s marginal probability.
We display the conditional distribution of matrix 'p' and 'q'. 

```{r}
cond_prob <- function(y,p) {
  columns <- apply(p,2,sum)
  marginalp <- columns[y]
  p[,y]/marginalp # to find the index cell in each condition - used in q6
}

cond_prob(1,p)  
cond_prob(1,q)  
```

...

<!-- --- -->

To compute expectations and variances we need to enter the values of $X$ and $Y$:

```{r}
x <- c(0,5,10)
y <- c(0,5,10,15)
```

## Question 5

Write functions, `EX` and `VarX`, that return the expectation and variance of $X$. The function should accept a joint probability matrix and a vector that lists the values, such as `x` and `y` above.

`## Answer 5`
Our function EX will take matrix `p` and the vector `x` which is the values X=Xi can take on. We set our variable 'rows' as the sum of the rows for each value of X=Xi. To find the expectation of X, it is a summation of the value of Xi and the corresponding marginal probability of Xi. Our expectation of X is 5.55.

Our function VarX will take matrix `p` and the vector `x` which is the values X=Xi can take on. We set our variable 'rows' as the sum of the rows for each value of X=Xi. To find the variance of X, it is the difference of the Xi value and the mean value of X (5.55), squared. Our variance of $X$ is 12.75.
```{r}
EX <- function(p,x){
  rows <- apply(p,1,sum)
  sum(x*rows) 
}

EX(p,x)

VarX <- function(p,x){
  rows <- apply(p,1,sum)
  sum((x-mean(x))^2*rows)
}
VarX(p,x)
```
...

<!-- --- -->

Finally, we move to conditional expectation. Remember that, for example, $$E(X|Y=5) = 0P(X=0|Y=5) + 5P(X=5|Y=5) + 10P(X=10|Y=5).$$ 

## Question 6

Write a function that returns the conditional expectation as a function of the joint probability table, a vector of values for $x$, a vector of values of $y$, and the value (not the index: use `?which`) of $Y$ to condition on.

Construct two joint probability matrices and associated outcomes for $X$ and $Y$, and test your functions above. 

`## Answer 6`
We create a function 'cond_exp' that takes matrix `p`, the list of X=Xi and Y=Yi values defined above, and 'Y' as the value to condition on. 
We use the which() function to determine whether which index of y that Y corresponds to. If y matches to a value in Y, it will return the corresponding index. It will set the element[i] in index, which we will use in the function 'cond_prob' to determine the conditional probability. The 'probs' variable returns the conditional probability on which the value of Y was conditioned on. 
Lastly, the conditional expectation is found through the summation of all X=Xi values and the corresponding conditional probabilities. It can be seen as a weighted average of each Xi value. 

```{r}
cond_exp <- function(p,x,y,Y) {
  index <- which(y==Y, y, arr.ind = TRUE) 
  probs <- cond_prob(index,p)
  sum(x*probs)
}
cond_exp(p,x,y,5)
cond_exp(q,x,y,10)
```
...